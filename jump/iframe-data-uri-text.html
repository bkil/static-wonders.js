<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset=utf-8>
  <title>JS eval in iframe</title>
  <link rel="shortcut icon" type=image/x-icon href=data:image/x-icon;,>
</head>
<body>
  <textarea maxlength=2048 id=t>JavaScript?</textarea>
  <br>
  <textarea rows=20 cols=64 id=d readonly></textarea>
  <br>
  <label onclick=s()>update html</label>
  <br>
  <iframe id=i width=100% height=200px></iframe>
  <script>
    function s() {
      b = document.getElementById('t').value;
      h = escape(b);
      if (!b.startsWith('data:'))
        h = h + 'data:text/html;charset=UTF-8,';
      window.location.hash = h;
    }
    function c() {
      v = window.location.hash.substring(1);
      i = v.indexOf('#');
      if (i > 0)
        v = v.substring(0, i);
      v = unescape(v);
      document.getElementById('i').src = v;
      document.getElementById('t').value = v;
      v = v.replaceAll('><', '>\n<');
      v = v.replaceAll('&lt;', '<').replaceAll('&gt;', '>').replaceAll('&quot;', '"').replaceAll('&amp;', '&');
      v = v.replaceAll('{', '\n{').replace(/([;{}])/g, '$1\n');
      document.getElementById('d').value = v;
    }
    c();
    window.addEventListener('hashchange', c);
  </script>
</body>
</html>
